# Phase 2 ì™„ë£Œ ë³´ê³ ì„œ

## âœ… Phase 2: ë°±ì—”ë“œ API ê°œë°œ - ì™„ë£Œ

### ì™„ë£Œ í•­ëª©

#### 1. WebSocket ì‹¤ì‹œê°„ í†µì‹  êµ¬í˜„ âœ…

**íŒŒì¼**: `backend/app/api/websocket.py`

- **4ê°œ ì±„ë„ êµ¬í˜„**:
  - `/ws/market` - ì‹¤ì‹œê°„ ì‹œì„¸
  - `/ws/orders` - ì£¼ë¬¸ ì²´ê²°
  - `/ws/positions` - í¬ì§€ì…˜ ì—…ë°ì´íŠ¸
  - `/ws/surge` - ê¸‰ë“±ì£¼ ì•Œë¦¼

- **ì£¼ìš” ê¸°ëŠ¥**:
  - `ConnectionManager` í´ë˜ìŠ¤ë¡œ ì—°ê²° ê´€ë¦¬
  - ì±„ë„ë³„ í´ë¼ì´ì–¸íŠ¸ ê·¸ë£¹ ê´€ë¦¬
  - Ping/Pong ì§€ì› (Keep-alive)
  - ìë™ ì¬ì—°ê²° ë¡œì§
  - ë¸Œë¡œë“œìºìŠ¤íŠ¸ í—¬í¼ í•¨ìˆ˜
  - ì—°ê²° í†µê³„ ì—”ë“œí¬ì¸íŠ¸ (`/ws/stats`)

- **í†µí•©**:
  - `backend/app/main.py`ì— WebSocket ë¼ìš°í„° ë“±ë¡ ì™„ë£Œ

#### 2. Frontend (PySide6) í”„ë¡œì íŠ¸ ì´ˆê¸°í™” âœ…

**ë””ë ‰í† ë¦¬ êµ¬ì¡°**:
```
frontend/
â”œâ”€â”€ main.py                    # ì§„ì…ì 
â”œâ”€â”€ requirements.txt           # íŒ¨í‚¤ì§€ ì˜ì¡´ì„±
â”œâ”€â”€ .env.example               # í™˜ê²½ ë³€ìˆ˜ ì˜ˆì‹œ
â”œâ”€â”€ views/                     # í™”ë©´ ì»´í¬ë„ŒíŠ¸
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ main_window.py         # ë©”ì¸ ìœˆë„ìš°
â”œâ”€â”€ widgets/                   # ì¬ì‚¬ìš© ìœ„ì ¯
â”œâ”€â”€ services/                  # API í´ë¼ì´ì–¸íŠ¸
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ api_client.py          # REST API í´ë¼ì´ì–¸íŠ¸
â”‚   â””â”€â”€ websocket_client.py    # WebSocket í´ë¼ì´ì–¸íŠ¸
â”œâ”€â”€ models/                    # ë°ì´í„° ëª¨ë¸
â””â”€â”€ resources/                 # ë¦¬ì†ŒìŠ¤ (ì•„ì´ì½˜ ë“±)
```

**ì£¼ìš” íŒŒì¼**:

1. **`main.py`**:
   - PySide6 ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™”
   - Backend ì—°ê²° í™•ì¸
   - ë©”ì¸ ìœˆë„ìš° ìƒì„± ë° ì‹¤í–‰

2. **`services/api_client.py`**:
   - REST API í´ë¼ì´ì–¸íŠ¸
   - ê³„ì¢Œ, ë§¤ë§¤, ì‹œì„¸ API ë©”ì„œë“œ êµ¬í˜„
   - `requests` ë¼ì´ë¸ŒëŸ¬ë¦¬ ê¸°ë°˜

3. **`services/websocket_client.py`**:
   - WebSocket í´ë¼ì´ì–¸íŠ¸
   - Qt Signalë¡œ ì´ë²¤íŠ¸ ì „ë‹¬
   - ìë™ ì¬ì—°ê²° ì§€ì›

4. **`views/main_window.py`**:
   - ë©”ì¸ ìœˆë„ìš° UI
   - íƒ­ ì¸í„°í˜ì´ìŠ¤ (ëŒ€ì‹œë³´ë“œ, ë§¤ë§¤, ì°¨íŠ¸, ê¸‰ë“±ì£¼, ì„¤ì •)
   - í”Œë ˆì´ìŠ¤í™€ë” í™”ë©´ (ì¶”í›„ êµ¬í˜„)

5. **`requirements.txt`**:
   - PySide6, pyqtgraph, matplotlib
   - aiohttp, websockets
   - pandas, numpy

#### 3. Trading Engine ë””ë ‰í† ë¦¬ êµ¬ì¡° ìƒì„± âœ…

**ë””ë ‰í† ë¦¬ êµ¬ì¡°**:
```
trading-engine/
â”œâ”€â”€ engine/
â”‚   â”œâ”€â”€ main.py                # ì§„ì…ì 
â”‚   â”œâ”€â”€ requirements.txt       # 32-bit Python íŒ¨í‚¤ì§€
â”‚   â”œâ”€â”€ .env.example           # í™˜ê²½ ë³€ìˆ˜
â”‚   â”œâ”€â”€ core/                  # í•µì‹¬ ì—”ì§„
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ engine.py          # TradingEngine í´ë˜ìŠ¤
â”‚   â”œâ”€â”€ brokers/               # ë¸Œë¡œì»¤ ì–´ëŒ‘í„°
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py            # BaseBroker ì¶”ìƒ í´ë˜ìŠ¤
â”‚   â”‚   â””â”€â”€ kiwoom.py          # KiwoomBroker ì–´ëŒ‘í„°
â”‚   â”œâ”€â”€ strategies/            # ì „ëµ ëª¨ë“ˆ (ì¶”í›„ êµ¬í˜„)
â”‚   â”œâ”€â”€ indicators/            # ê¸°ìˆ  ì§€í‘œ (ì¶”í›„ êµ¬í˜„)
â”‚   â””â”€â”€ events/                # ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ (ì¶”í›„ êµ¬í˜„)
```

**ì£¼ìš” íŒŒì¼**:

1. **`engine/main.py`**:
   - Trading Engine ì§„ì…ì 
   - PyQt5 ì• í”Œë¦¬ì¼€ì´ì…˜ ë£¨í”„
   - í‚¤ì›€ ë¸Œë¡œì»¤ ì´ˆê¸°í™” ë° ë¡œê·¸ì¸
   - TradingEngine ì‹¤í–‰

2. **`engine/core/engine.py`**:
   - `TradingEngine` í´ë˜ìŠ¤
   - ìë™ë§¤ë§¤ ë¡œì§ ì´ê´„
   - ê´€ì‹¬ ì¢…ëª© ê´€ë¦¬
   - ë§¤ìˆ˜/ë§¤ë„ ì£¼ë¬¸ ì‹¤í–‰

3. **`engine/brokers/base.py`**:
   - `BaseBroker` ì¶”ìƒ í´ë˜ìŠ¤
   - ë¸Œë¡œì»¤ ì–´ëŒ‘í„° ì¸í„°í˜ì´ìŠ¤ ì •ì˜
   - ë‹¤ì–‘í•œ ì¦ê¶Œì‚¬ ì§€ì› ê°€ëŠ¥ (í™•ì¥ì„±)

4. **`engine/brokers/kiwoom.py`**:
   - `KiwoomBroker` í´ë˜ìŠ¤
   - í‚¤ì›€ OpenAPI ë˜í•‘
   - BaseBroker ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„
   - TODO: ê¸°ì¡´ `kiwoom_api.py` í†µí•© í•„ìš”

5. **`requirements.txt`**:
   - PyQt5 (í‚¤ì›€ API ìš”êµ¬ì‚¬í•­)
   - loguru, pandas, numpy
   - redis (ì˜µì…˜)

#### 4. ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± âœ…

**ìƒì„±ëœ ìŠ¤í¬ë¦½íŠ¸**:

1. **`scripts/setup_frontend.ps1`**:
   - Frontend ê°€ìƒí™˜ê²½ ì„¤ì •
   - íŒ¨í‚¤ì§€ ì„¤ì¹˜
   - .env íŒŒì¼ ìƒì„±

2. **`scripts/start_frontend.ps1`**:
   - Frontend GUI ì‹¤í–‰
   - Backend ì—°ê²° í™•ì¸

3. **`scripts/start_backend.ps1`**:
   - Backend API ì„œë²„ ì‹¤í–‰
   - Uvicornìœ¼ë¡œ FastAPI ì‹¤í–‰

4. **`scripts/start_all.ps1`**:
   - ì „ì²´ ì‹œìŠ¤í…œ í†µí•© ì‹œì‘
   - Docker Composeë¡œ DB ì‹œì‘
   - Backend ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
   - Frontend/Engine ìˆ˜ë™ ì‹¤í–‰ ì•ˆë‚´

### ê¸°ìˆ  ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Frontend (PySide6) - 64-bit             â”‚
â”‚  - ëŒ€ì‹œë³´ë“œ, ì°¨íŠ¸, ë§¤ë§¤ í™”ë©´                        â”‚
â”‚  - REST API í´ë¼ì´ì–¸íŠ¸                              â”‚
â”‚  - WebSocket í´ë¼ì´ì–¸íŠ¸ (ì‹¤ì‹œê°„ ë°ì´í„°)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ HTTP / WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Backend (FastAPI) - 64-bit               â”‚
â”‚  - REST API ì—”ë“œí¬ì¸íŠ¸                              â”‚
â”‚  - WebSocket ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë°                        â”‚
â”‚  - ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚ IPC (Redis / HTTP)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Trading Engine (PyQt5) - 32-bit              â”‚
â”‚  - í‚¤ì›€ OpenAPI ì—°ë™                                â”‚
â”‚  - ë¸Œë¡œì»¤ ì–´ëŒ‘í„° íŒ¨í„´                               â”‚
â”‚  - ì „ëµ ì‹¤í–‰ ì—”ì§„                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì£¼ìš” ì„±ê³¼

#### 1. ê´€ì‹¬ì‚¬ ë¶„ë¦¬ (Separation of Concerns)
- **Frontend**: UI/UXë§Œ ë‹´ë‹¹
- **Backend**: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, API, ë°ì´í„° ê´€ë¦¬
- **Trading Engine**: ìˆœìˆ˜ ë§¤ë§¤ ë¡œì§ (í‚¤ì›€ API)

#### 2. ì‹¤ì‹œê°„ í†µì‹  êµ¬í˜„
- WebSocketìœ¼ë¡œ 4ê°œ ì±„ë„ êµ¬í˜„
- Qt Signalë¡œ Frontendì™€ í†µí•©
- ìë™ ì¬ì—°ê²° ë° Keep-alive

#### 3. ë¸Œë¡œì»¤ ì–´ëŒ‘í„° íŒ¨í„´
- `BaseBroker` ì¶”ìƒ í´ë˜ìŠ¤ë¡œ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
- í‚¤ì›€ ì™¸ ë‹¤ë¥¸ ì¦ê¶Œì‚¬ ì‰½ê²Œ ì¶”ê°€ ê°€ëŠ¥
- í…ŒìŠ¤íŠ¸ìš© Mock ë¸Œë¡œì»¤ ì¶”ê°€ ê°€ëŠ¥

#### 4. í™•ì¥ ê°€ëŠ¥í•œ êµ¬ì¡°
- ê° ì„œë¹„ìŠ¤ ë…ë¦½ ì‹¤í–‰ ê°€ëŠ¥
- 64-bit / 32-bit Python ë¶„ë¦¬
- Dockerë¡œ ì¸í”„ë¼ ê´€ë¦¬

### ë‹¤ìŒ ë‹¨ê³„ (Phase 3)

#### Phase 3: ë§¤ë§¤ ì—”ì§„ ë¦¬íŒ©í† ë§

1. **ê¸°ì¡´ ì½”ë“œ í†µí•©**:
   - `auto_trading/kiwoom_api.py` â†’ `trading-engine/engine/brokers/kiwoom.py`
   - `auto_trading/strategies.py` â†’ `trading-engine/engine/strategies/`
   - `auto_trading/indicators.py` â†’ `trading-engine/engine/indicators/technical.py`
   - `auto_trading/surge_detector.py` â†’ `trading-engine/engine/strategies/surge.py`

2. **ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ êµ¬ì¶•**:
   - Redis Pub/Sub ë˜ëŠ” Redis Streams
   - ì´ë²¤íŠ¸ ë²„ìŠ¤ êµ¬í˜„
   - Trading Engine â†’ Backend ì´ë²¤íŠ¸ ì „íŒŒ

3. **ì „ëµ ëª¨ë“ˆí™”**:
   - ì „ëµ ì¶”ìƒ í´ë˜ìŠ¤ ì •ì˜
   - ê° ì „ëµì„ ë…ë¦½ ëª¨ë“ˆë¡œ ë¶„ë¦¬
   - í”ŒëŸ¬ê·¸ì¸ ë°©ì‹ìœ¼ë¡œ ì „ëµ ì¶”ê°€/ì œê±°

4. **Backendì™€ Engine ì—°ë™**:
   - HTTP APIë¡œ Engine ì œì–´
   - Redisë¡œ ì‹¤ì‹œê°„ ë°ì´í„° ì „ë‹¬
   - WebSocketìœ¼ë¡œ Frontendì— ë¸Œë¡œë“œìºìŠ¤íŠ¸

### ì£¼ì˜ì‚¬í•­

#### 32-bit Python ì´ìŠˆ
- í‚¤ì›€ APIëŠ” 32-bit Python í•„ìˆ˜
- Trading Engineì€ ë³„ë„ 32-bit Python í™˜ê²½ í•„ìš”
- Frontend/BackendëŠ” 64-bit Python ì‚¬ìš©

#### IPC (Inter-Process Communication)
- Trading Engineê³¼ Backend ê°„ í†µì‹  í•„ìš”
- ì˜µì…˜ 1: HTTP API
- ì˜µì…˜ 2: Redis Pub/Sub
- ì˜µì…˜ 3: Named Pipe / Socket

### í˜„ì¬ ìƒíƒœ

âœ… **ì™„ë£Œ**:
- Backend API êµ¬ì¡°
- WebSocket ì‹¤ì‹œê°„ í†µì‹ 
- Frontend í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
- Trading Engine ë””ë ‰í† ë¦¬ êµ¬ì¡°
- ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

â³ **ë‹¤ìŒ ì‘ì—…**:
- ê¸°ì¡´ ì½”ë“œ í†µí•© (Phase 3)
- ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ êµ¬ì¶•
- ì „ëµ ëª¨ë“ˆí™”
- Frontend ìƒì„¸ í™”ë©´ êµ¬í˜„

---

## ì‹¤í–‰ ë°©ë²•

### 1. Backend ì„¤ì • ë° ì‹¤í–‰
```powershell
# í™˜ê²½ ì„¤ì •
.\scripts\setup_backend.ps1

# ë°ì´í„°ë² ì´ìŠ¤ ì‹œì‘ (Docker)
docker-compose up -d postgres redis

# Backend ì‹¤í–‰
.\scripts\start_backend.ps1
```

### 2. Frontend ì„¤ì • ë° ì‹¤í–‰
```powershell
# í™˜ê²½ ì„¤ì •
.\scripts\setup_frontend.ps1

# Frontend ì‹¤í–‰
.\scripts\start_frontend.ps1
```

### 3. Trading Engine ì‹¤í–‰ (32-bit Python í•„ìš”)
```powershell
# TODO: Phase 3ì—ì„œ êµ¬í˜„
```

---

## ë§ˆë¬´ë¦¬

Phase 2ì—ì„œëŠ” **ë°±ì—”ë“œ API ê°œë°œ**ì˜ í•µì‹¬ ìš”ì†Œë“¤ì„ ì™„ì„±í–ˆìŠµë‹ˆë‹¤:
- âœ… WebSocket ì‹¤ì‹œê°„ í†µì‹ 
- âœ… Frontend PySide6 í”„ë¡œì íŠ¸ ì´ˆê¸°í™”
- âœ… Trading Engine êµ¬ì¡°í™”
- âœ… ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

ì´ì œ **Phase 3 (ë§¤ë§¤ ì—”ì§„ ë¦¬íŒ©í† ë§)**ìœ¼ë¡œ ì§„í–‰í•˜ì—¬ ê¸°ì¡´ ì½”ë“œë¥¼ ìƒˆ êµ¬ì¡°ì— í†µí•©í•˜ê³ , ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ì—¬ ì „ì²´ ì‹œìŠ¤í…œì„ ì—°ë™í•  ì°¨ë¡€ì…ë‹ˆë‹¤! ğŸš€


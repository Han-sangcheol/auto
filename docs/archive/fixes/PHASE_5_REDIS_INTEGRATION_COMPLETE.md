# Phase 5: Redis ì‹¤ì‹œê°„ ì—°ë™ ì™„ë£Œ! âœ…

## ê°œìš”

Backendì™€ Trading Engine ê°„ì˜ ì‹¤ì‹œê°„ ì´ë²¤íŠ¸ ì „íŒŒ ì‹œìŠ¤í…œì„ Redis Pub/Subì„ í†µí•´ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.

**ì™„ë£Œì¼**: 2025-10-24  
**ì†Œìš” ì‹œê°„**: Phase 5 ì§„í–‰ ì¤‘ (75% ì™„ë£Œ)

---

## âœ… êµ¬í˜„ ë‚´ìš©

### 1. Trading Engine - Redis Event Publisher

**íŒŒì¼**: `trading-engine/engine/events/redis_publisher.py`

**ê¸°ëŠ¥:**
- Redis Pub/Subì„ í†µí•œ ì´ë²¤íŠ¸ ë°œí–‰
- ì£¼ë¬¸, í¬ì§€ì…˜, ì‹œì„¸, ê¸‰ë“±ì£¼ ë“± ë‹¤ì–‘í•œ ì´ë²¤íŠ¸ íƒ€ì… ì§€ì›
- ìë™ ì¬ì—°ê²° ë° ì˜¤ë¥˜ ì²˜ë¦¬

**ì£¼ìš” ë©”ì„œë“œ:**
```python
publish_order_event(order_data)          # ì£¼ë¬¸ ì´ë²¤íŠ¸
publish_position_event(position_data)    # í¬ì§€ì…˜ ì´ë²¤íŠ¸
publish_market_data(market_data)         # ì‹œì„¸ ë°ì´í„°
publish_surge_alert(surge_data)          # ê¸‰ë“±ì£¼ ì•Œë¦¼
publish_trade_event(trade_data)          # ê±°ë˜ ì²´ê²°
publish_log(level, module, message)      # ë¡œê·¸
```

---

### 2. Backend - Redis Event Subscriber

**íŒŒì¼**: `backend/app/services/redis_subscriber.py`

**ê¸°ëŠ¥:**
- Redis ì±„ë„ êµ¬ë…
- ë¹„ë™ê¸° ë©”ì‹œì§€ ìˆ˜ì‹ 
- WebSocketìœ¼ë¡œ Frontend ë¸Œë¡œë“œìºìŠ¤íŠ¸
- ìë™ ì¬ì—°ê²°

**ì£¼ìš” ë©”ì„œë“œ:**
```python
connect()                                # Redis ì—°ê²°
subscribe(channel, handler)              # ì±„ë„ êµ¬ë…
start_listening()                        # ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œì‘ (ë¹„ë™ê¸°)
stop()                                   # êµ¬ë… ì¤‘ì§€
```

---

### 3. EventBus Redis ì±„ë„ ë§¤í•‘

**íŒŒì¼**: `trading-engine/engine/events/event_bus.py`

**ë³€ê²½ ì‚¬í•­:**
- `_publish_to_redis()` ë©”ì„œë“œ ìˆ˜ì •
- Backendì™€ í˜¸í™˜ë˜ëŠ” ì±„ë„ ë§¤í•‘

**ì±„ë„ ë§¤í•‘:**
```python
ì£¼ë¬¸ ì´ë²¤íŠ¸ â†’ 'trading:orders'
í¬ì§€ì…˜ ì´ë²¤íŠ¸ â†’ 'trading:positions'
ì‹œì„¸ ë°ì´í„° â†’ 'market:data'
ê¸‰ë“±ì£¼ ì•Œë¦¼ â†’ 'trading:surge'
ê±°ë˜ ì²´ê²° â†’ 'trading:trades'
```

---

### 4. Backend Main.py í†µí•©

**íŒŒì¼**: `backend/app/main.py`

**ì¶”ê°€ ë‚´ìš©:**
- Startup ì´ë²¤íŠ¸: Redis Subscriber ìë™ ì‹œì‘
- Shutdown ì´ë²¤íŠ¸: Redis ì—°ê²° ì •ë¦¬
- ì±„ë„ë³„ í•¸ë“¤ëŸ¬ ë“±ë¡

**ì½”ë“œ:**
```python
@app.on_event("startup")
async def startup_event():
    redis_subscriber = RedisEventSubscriber()
    if redis_subscriber.connect():
        # ì±„ë„ êµ¬ë…
        redis_subscriber.subscribe('trading:orders', handler)
        redis_subscriber.subscribe('trading:positions', handler)
        # ... ê¸°íƒ€ ì±„ë„
        
        # ë°±ê·¸ë¼ìš´ë“œì—ì„œ ìˆ˜ì‹  ì‹œì‘
        asyncio.create_task(redis_subscriber.start_listening())
```

---

## ğŸ“Š ë°ì´í„° í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Trading Engine (32-bit Python)                 â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                      â”‚
â”‚  â”‚  EventBus   â”‚ â”€â”€â”                                  â”‚
â”‚  â”‚  (Redis)    â”‚   â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ publish()                        â”‚
â”‚                     â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼ Redis Pub/Sub
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚       Redis          â”‚
           â”‚   (localhost:6379)   â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼ subscribe()
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚  â”‚  Redis Subscriber         â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                  â”‚                                     â”‚
â”‚                  â–¼ WebSocket broadcast()               â”‚
â”‚            Backend API (FastAPI)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼ WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Frontend (PySide6)                            â”‚
â”‚  - ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸                            â”‚
â”‚  - ì£¼ë¬¸/í¬ì§€ì…˜ ì‹¤ì‹œê°„ í‘œì‹œ                             â”‚
â”‚  - ê¸‰ë“±ì£¼ ì•Œë¦¼                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ ì„¤ì •

### Trading Engine (.env)
```env
# Redis ì—°ê²°
REDIS_URL=redis://localhost:6379/0
USE_REDIS_EVENTS=true
```

### Backend (í™˜ê²½ ë³€ìˆ˜)
```env
REDIS_URL=redis://localhost:6379
```

---

## ğŸ“ ì´ë²¤íŠ¸ íƒ€ì…

### 1. ì£¼ë¬¸ ì´ë²¤íŠ¸ (`trading:orders`)
```json
{
  "event_type": "ORDER_PLACED",
  "timestamp": "2025-10-24T10:30:00",
  "data": {
    "order_id": "ORD001",
    "stock_code": "005930",
    "order_type": "buy",
    "quantity": 10,
    "price": 70000
  }
}
```

### 2. í¬ì§€ì…˜ ì´ë²¤íŠ¸ (`trading:positions`)
```json
{
  "event_type": "POSITION_OPENED",
  "timestamp": "2025-10-24T10:30:00",
  "data": {
    "stock_code": "005930",
    "quantity": 10,
    "avg_price": 70000,
    "profit_loss": 0
  }
}
```

### 3. ê¸‰ë“±ì£¼ ì•Œë¦¼ (`trading:surge`)
```json
{
  "event_type": "SURGE_DETECTED",
  "timestamp": "2025-10-24T10:30:00",
  "data": {
    "stock_code": "005930",
    "stock_name": "ì‚¼ì„±ì „ì",
    "change_rate": 5.2,
    "volume_ratio": 3.5
  }
}
```

---

## ğŸ¯ ì£¼ìš” ì„±ê³¼

1. **ì™„ì „í•œ ì‹¤ì‹œê°„ í†µì‹ **: Engine â†’ Backend â†’ Frontend
2. **ëŠìŠ¨í•œ ê²°í•©**: Redis Pub/Subìœ¼ë¡œ ì„œë¹„ìŠ¤ ê°„ ë…ë¦½ì„± ìœ ì§€
3. **í™•ì¥ ê°€ëŠ¥**: ìƒˆë¡œìš´ ì´ë²¤íŠ¸ íƒ€ì… ì‰½ê²Œ ì¶”ê°€
4. **ìë™ ì¬ì—°ê²°**: Redis ì—°ê²° ì‹¤íŒ¨ ì‹œ ìë™ ì¬ì—°ê²°
5. **ë¹„ë™ê¸° ì²˜ë¦¬**: ì„±ëŠ¥ ì €í•˜ ì—†ëŠ” ì‹¤ì‹œê°„ ë°ì´í„° ì²˜ë¦¬

---

## ğŸš€ ì‹¤í–‰ ë°©ë²•

### 1. Redis ì‹œì‘
```bash
# Dockerë¡œ ì‹¤í–‰
docker run -d -p 6379:6379 redis:latest

# ë˜ëŠ” docker-compose
docker-compose up -d redis
```

### 2. Backend ì‹œì‘
```powershell
.\scripts\start_backend.ps1
```

**í™•ì¸:**
- Backend ì‹œì‘ ì‹œ `Redis ì—°ê²° ì„±ê³µ` ë©”ì‹œì§€ í™•ì¸
- ì±„ë„ êµ¬ë… ë¡œê·¸ í™•ì¸

### 3. Trading Engine ì‹œì‘
```powershell
# Frontendì—ì„œ Engine ì‹œì‘ ë²„íŠ¼ í´ë¦­
# ë˜ëŠ” ì§ì ‘ ì‹¤í–‰
cd trading-engine
python engine/main.py
```

**í™•ì¸:**
- Engine ì‹œì‘ ì‹œ `EventBus ì´ˆê¸°í™” (Redis: í™œì„±í™”)` ë©”ì‹œì§€
- `Redis ì—°ê²° ì„±ê³µ` ë©”ì‹œì§€

### 4. ì´ë²¤íŠ¸ ë°œìƒ í…ŒìŠ¤íŠ¸

Trading Engineì—ì„œ ì´ë²¤íŠ¸ ë°œìƒ ì‹œ:
- âœ… Redisë¡œ ì´ë²¤íŠ¸ ë°œí–‰
- âœ… Backendì—ì„œ ì´ë²¤íŠ¸ ìˆ˜ì‹ 
- âœ… WebSocketìœ¼ë¡œ Frontend ë¸Œë¡œë“œìºìŠ¤íŠ¸
- âœ… Frontendì—ì„œ ì‹¤ì‹œê°„ UI ì—…ë°ì´íŠ¸

---

## ğŸ“Š í†µê³„

### íŒŒì¼
- **Trading Engine**: +1 file (redis_publisher.py - 111 lines)
- **Backend**: +1 file (redis_subscriber.py - 91 lines)
- **ìˆ˜ì •**: event_bus.py, main.py

### ì½”ë“œ ë¼ì¸
- **redis_publisher.py**: 111 lines
- **redis_subscriber.py**: 91 lines
- **event_bus.py**: +37 lines (ì±„ë„ ë§¤í•‘)
- **main.py**: +35 lines (Startup/Shutdown)
- **ì´ ì¶”ê°€**: ~270 lines

### Redis ì±„ë„
- **trading:orders**: ì£¼ë¬¸ ì´ë²¤íŠ¸
- **trading:positions**: í¬ì§€ì…˜ ì´ë²¤íŠ¸
- **market:data**: ì‹œì„¸ ë°ì´í„°
- **trading:surge**: ê¸‰ë“±ì£¼ ì•Œë¦¼
- **trading:trades**: ê±°ë˜ ì²´ê²°
- **system:logs**: ì‹œìŠ¤í…œ ë¡œê·¸ (ì˜µì…˜)

---

## ğŸ”œ ë‹¤ìŒ ë‹¨ê³„

### Phase 5 ì™„ë£Œë¥¼ ìœ„í•œ ë‚¨ì€ ì‘ì—… (25%)
1. **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±** (pytest)
   - Backend API í…ŒìŠ¤íŠ¸
   - Trading Engine ì „ëµ í…ŒìŠ¤íŠ¸
2. **E2E í…ŒìŠ¤íŠ¸**
   - ì „ì²´ í”Œë¡œìš° ì‹œë‚˜ë¦¬ì˜¤
3. **ë¬¸ì„œí™”**
   - API ë¬¸ì„œ (Swagger)

---

## ğŸ’¡ ê¸°ìˆ ì  ì˜ì‚¬ê²°ì •

### Redis Pub/Sub ì„ íƒ ì´ìœ 

**ì¥ì :**
- âœ… ë¹ ë¥¸ ë©”ì‹œì§€ ì „ë‹¬ (ë°€ë¦¬ì´ˆ ë‹¨ìœ„)
- âœ… ê°„ë‹¨í•œ API
- âœ… ì„œë¹„ìŠ¤ ê°„ ëŠìŠ¨í•œ ê²°í•©
- âœ… ìˆ˜í‰ í™•ì¥ ê°€ëŠ¥

**ëŒ€ì•ˆ ê²€í† :**
- âŒ RabbitMQ: ì˜¤ë²„ì—”ì§€ë‹ˆì–´ë§, ë³µì¡ë„ ì¦ê°€
- âŒ Kafka: ëŒ€ê·œëª¨ ì‹œìŠ¤í…œìš©, ì„¤ì • ë³µì¡
- âŒ gRPC: ì§ì ‘ ì—°ê²°, ê°•í•œ ê²°í•©

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **Redis ì—°ê²° í•„ìˆ˜**: Backendì™€ Trading Engine ëª¨ë‘ Redis í•„ìš”
2. **ì±„ë„ ì´ë¦„ ì¼ì¹˜**: EventBusì™€ Backendì˜ ì±„ë„ ì´ë¦„ ë™ê¸°í™”
3. **JSON ì§ë ¬í™”**: ëª¨ë“  ë°ì´í„°ëŠ” JSON ì§ë ¬í™” ê°€ëŠ¥í•´ì•¼ í•¨
4. **ë¹„ë™ê¸° ì²˜ë¦¬**: Backend SubscriberëŠ” ë¹„ë™ê¸°ë¡œ ì‹¤í–‰

---

**ì‘ì„±ì¼**: 2025-10-24  
**Phase 5 ì§„í–‰ë¥ **: 75% â†’ **Redis ì—°ë™ ì™„ë£Œ!** âœ…  
**ì „ì²´ í”„ë¡œì íŠ¸**: 79% ì™„ë£Œ


# 🚨 GUI 응답없음 및 과부하 해결 (2025-10-28)

## 📊 문제 분석

### 발생한 문제
- **GUI 응답없음**: 프로그램이 멈추고 GUI가 작동하지 않음
- **과부하**: 급등주가 너무 많이 감지되어 시스템 과부하
- **API 제한**: 키움 API 요청 과다로 조회 실패 (-202 에러)

### 원인 분석
1. **급등주 조건 너무 낮음**
   - 상승률 5% → 너무 많은 종목 감지
   - 거래량 2배 → 기준이 낮음
   
2. **모니터링 종목 과다**
   - 100개 종목 실시간 감시 → API 과부하
   - 각 종목마다 실시간 데이터 수신
   
3. **데이터베이스 부하**
   - 실시간 저장으로 추가 I/O 부하
   - SQLite 동시 쓰기 부담

4. **GUI 업데이트 과다**
   - 실시간 알림이 너무 많음
   - 로그 메시지 폭주

## ✅ 적용된 해결책

### 1. 급등주 감지 기준 강화 ⚡

**변경 전:**
```python
SURGE_CANDIDATE_COUNT = 100  # 거래대금 상위 100개
SURGE_MIN_CHANGE_RATE = 5.0  # 상승률 5% 이상
SURGE_MIN_VOLUME_RATIO = 2.0  # 거래량 2배 이상
```

**변경 후:**
```python
SURGE_CANDIDATE_COUNT = 30   # 거래대금 상위 30개 (70% 감소)
SURGE_MIN_CHANGE_RATE = 10.0 # 상승률 10% 이상 (2배 강화)
SURGE_MIN_VOLUME_RATIO = 3.0 # 거래량 3배 이상 (50% 강화)
```

**효과:**
- 모니터링 종목: 100개 → 30개 (70% 감소)
- 급등주 감지 빈도: 약 80% 감소 예상
- API 요청 부하: 70% 감소

### 2. 데이터베이스 비활성화 (임시) 💾

**변경:**
```python
DB_ENABLED = False  # True → False
```

**효과:**
- 실시간 저장 부하 제거
- 디스크 I/O 부하 감소
- 메모리 사용량 감소

**재활성화 방법:**
```bash
# .env 파일에 추가하거나 수정
DB_ENABLED=True
```

### 3. 로그 레벨 최적화 📝

**유지:**
```python
LOG_LEVEL = INFO  # DEBUG 로그 제거로 부하 감소
```

**효과:**
- DEBUG 로그 제거
- 로그 파일 크기 감소
- 파일 쓰기 부하 감소

## 📈 성능 개선 예상

| 항목 | 변경 전 | 변경 후 | 개선률 |
|------|---------|---------|--------|
| 모니터링 종목 | 100개 | 30개 | 70% 감소 |
| 급등주 감지 빈도 | 높음 | 낮음 | ~80% 감소 |
| API 요청 | 과다 | 정상 | 70% 감소 |
| 데이터베이스 부하 | 있음 | 없음 | 100% 감소 |
| GUI 응답성 | 느림 | 빠름 | 대폭 개선 |

## 🚀 재시작 가이드

### 1. 설정 확인
```bash
cd auto_trading
python -c "from config import Config; Config.print_config()"
```

**확인 사항:**
- ✅ 급등주 후보: 30개
- ✅ 급등 기준: 상승률 10%, 거래량 3배
- ✅ DB 저장: 비활성화

### 2. 프로그램 시작
```bash
start.bat
```

### 3. 정상 작동 확인

**예상 로그:**
```
🚀 급등주 후보군 선정 (거래대금 상위 30개)
📊 조건: 상승률 >= 10.0%, 거래량 >= 3.0배
```

**급등주 감지 시:**
```
🚀 급등 감지! 종목명 (코드) | 상승률: +10.5% | 거래량: 3.2배
```

## ⚙️ 추가 최적화 옵션

### 필요 시 더 강화

**.env 파일에 추가:**
```bash
# 급등주 감지 더 강화 (선택)
SURGE_MIN_CHANGE_RATE=15.0  # 15% 이상
SURGE_MIN_VOLUME_RATIO=5.0  # 5배 이상

# 모니터링 종목 더 감소 (선택)
SURGE_CANDIDATE_COUNT=20    # 20개만

# 헬스 체크 간격 증가 (선택)
HEALTH_CHECK_INTERVAL=180   # 3분마다
```

### 데이터베이스 재활성화

**안정화 후:**
```bash
# .env 파일에 추가
DB_ENABLED=True
```

## 🎯 권장 운영 방식

### 초기 테스트 (1-2일)
- 현재 설정 유지 (30개, 10%, 3배)
- 안정성 확인
- 급등주 감지 빈도 모니터링

### 안정화 후 (3일차~)
- 필요시 SURGE_CANDIDATE_COUNT를 50개로 증가
- 데이터베이스 재활성화
- 성능 모니터링

### 장기 운영
- 시장 상황에 따라 조건 조정
- 일일 로그 확인
- 정기적인 최적화

## ⚠️ 주의사항

### 1. 급등주 감지 감소
- **트레이드오프**: 안정성 ↑, 기회 ↓
- 강한 급등만 감지됨 (10% 이상)
- 놓치는 종목도 있을 수 있음

### 2. 데이터 저장 중단
- 과거 데이터 분석 불가 (임시)
- 백테스팅 데이터 수집 안 됨
- 필요 시 재활성화 권장

### 3. 시장 상황 고려
- 강세장: 급등주 많음 → 조건 유지
- 횡보장: 급등주 적음 → 조건 완화 가능
- 약세장: 급등주 적음 → 조건 완화 고려

## 📊 모니터링 체크리스트

### 실행 후 확인 사항

- [ ] GUI가 정상 응답하는가?
- [ ] 급등주 감지 빈도가 적정한가? (시간당 0-3개)
- [ ] API 에러(-202)가 없는가?
- [ ] CPU 사용률이 정상인가? (50% 이하)
- [ ] 메모리 사용률이 정상인가? (1GB 이하)

### 문제 발생 시

1. **여전히 과부하**
   - SURGE_CANDIDATE_COUNT를 20으로 감소
   - SURGE_MIN_CHANGE_RATE를 15.0으로 증가

2. **급등주가 너무 적음**
   - SURGE_MIN_CHANGE_RATE를 8.0으로 감소
   - SURGE_MIN_VOLUME_RATIO를 2.5로 감소

3. **API 에러 지속**
   - 관심종목(WATCH_LIST) 감소
   - SURGE_CANDIDATE_COUNT를 20으로 감소

## 📚 관련 문서

- `OVERLOAD_PREVENTION.md` - 과부하 예방 가이드
- `TROUBLESHOOTING.md` - 일반 문제 해결
- `config.py` - 설정 파일
- `env.template` - 환경 변수 템플릿

## 🆘 추가 지원

문제가 지속되면:
1. `logs/error_*.log` 확인
2. `logs/trading_*.log` 확인
3. 이슈 리포트 작성

---

**최종 업데이트**: 2025-10-28
**상태**: ✅ 적용 완료
**효과**: 🚀 대폭 개선 예상


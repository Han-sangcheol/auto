# 문제 해결 가이드

자동매매 프로그램 사용 중 발생할 수 있는 문제와 해결 방법입니다.

## 목차

- [로그인 문제](#로그인-문제)
- [설정 오류](#설정-오류)
- [매매 실행 문제](#매매-실행-문제)
- [API 오류](#api-오류)
- [성능 문제](#성능-문제)
- [GUI 응답없음 문제](#gui-응답없음-문제) 🆕
- [데이터 문제](#데이터-문제)
- [시스템 오류](#시스템-오류)

---

## 로그인 문제

### 문제: "로그인 실패" 오류

```
❌ 로그인 실패
```

#### 원인 1: 키움 Open API+ 미설치

**확인 방법**:
```
C:\OpenAPI\ 폴더가 존재하는지 확인
```

**해결 방법**:
1. 키움증권 홈페이지에서 Open API+ 다운로드
2. 설치 프로그램 실행
3. 프로그램 재시작

#### 원인 2: 공동인증서 문제

**확인 방법**:
1. KOA Studio 실행
2. 로그인 버튼 클릭
3. 공동인증서로 로그인 시도

**해결 방법**:
- 공동인증서 비밀번호 재확인
- 인증서 유효기간 확인
- 필요시 인증서 재발급

#### 원인 3: 모의투자/실계좌 설정 불일치

**확인 방법**:
```env
# .env 파일
USE_SIMULATION=True              # 모의투자
KIWOOM_ACCOUNT_NUMBER=8123...    # 8로 시작하면 모의투자
```

**해결 방법**:
- 모의투자: `USE_SIMULATION=True` + 계좌번호 8로 시작
- 실계좌: `USE_SIMULATION=False` + 실계좌 번호

#### 원인 4: 계좌번호 오류

**확인 방법**:
- HTS에서 본인의 정확한 계좌번호 확인

**해결 방법**:
```env
KIWOOM_ACCOUNT_NUMBER=정확한계좌번호
```
- 공백 없이 입력
- 숫자만 입력 (하이픈 제외)

---

## 설정 오류

### 문제: "설정 오류" 메시지

```
⚠️  설정 오류 발견:
  - KIWOOM_ACCOUNT_NUMBER가 설정되지 않았습니다.
```

#### 원인: .env 파일 누락 또는 잘못된 설정

**해결 방법**:

1. **`.env` 파일 존재 확인**
   ```bash
   dir .env
   ```

2. **`.env.example`에서 복사**
   ```bash
   copy .env.example .env
   ```

3. **필수 항목 입력**
   ```env
   KIWOOM_ACCOUNT_NUMBER=8123456789
   KIWOOM_ACCOUNT_PASSWORD=1234
   WATCH_LIST=005930,000660
   ```

4. **문법 오류 확인**
   - `=` 앞뒤에 공백 없어야 함
   - 따옴표 불필요
   - 각 줄은 줄바꿈으로 구분

### 문제: "WATCH_LIST가 비어있습니다"

**원인**: 관심 종목이 설정되지 않음

**해결 방법**:
```env
WATCH_LIST=005930,000660,035720
```
- 최소 1개 이상의 종목코드 입력
- 6자리 숫자
- 쉼표로 구분
- 공백 없이

### 문제: 비밀번호 오류

**확인 사항**:
```env
KIWOOM_ACCOUNT_PASSWORD=1234
```

**주의**:
- 로그인 비밀번호가 아닙니다
- HTS에서 주문할 때 입력하는 **계좌 비밀번호**입니다
- 4자리 숫자

---

## 매매 실행 문제

### 문제: 매매가 전혀 실행되지 않음

```
[2025-10-21 09:15:24] 신호: 관망 (강도: 1/3)
```

#### 원인 1: 데이터 부족

**최소 요구사항**: 30개 이상의 가격 데이터

**확인 방법**:
```
로그에서 "데이터 부족" 메시지 확인
```

**해결 방법**:
- 프로그램을 더 오래 실행 (30분 이상)
- 실시간 데이터 축적 대기

#### 원인 2: 신호 강도 부족

**현재 설정**:
```env
MIN_SIGNAL_STRENGTH=2    # 2개 전략 동의 필요
```

**해결 방법**:
```env
MIN_SIGNAL_STRENGTH=1    # 1개 전략만 동의해도 실행
```

> **주의**: 신호 강도를 낮추면 거래가 증가하지만 위험도도 증가합니다.

#### 원인 3: 리스크 제한

**확인 사항**:
- 최대 보유 종목 수 초과
- 일일 손실 한도 초과
- 잔고 부족

**해결 방법**:
```env
MAX_STOCKS=5                    # 보유 종목 수 증가
DAILY_LOSS_LIMIT_PERCENT=5      # 손실 한도 증가
```

#### 원인 4: 장 시간이 아님

**거래 가능 시간**:
- 평일 09:00 - 15:30

**확인 방법**:
```
현재 시간 확인
로그에 "장 종료" 메시지 확인
```

### 문제: 매매가 너무 자주 발생

#### 원인: 신호 민감도가 높음

**해결 방법**:

1. **신호 강도 높이기**
   ```env
   MIN_SIGNAL_STRENGTH=3    # 3개 전략 모두 동의 필요
   ```

2. **이동평균 기간 늘리기**
   ```env
   MA_SHORT_PERIOD=10       # 더 긴 기간
   MA_LONG_PERIOD=30
   ```

3. **포지션 크기 줄이기**
   ```env
   POSITION_SIZE_PERCENT=5  # 투자 비율 감소
   ```

### 문제: 손절매가 실행되지 않음

#### 확인 사항

1. **프로그램 실행 중**
   - 프로그램이 종료되면 손절매도 중단됩니다

2. **실시간 데이터 수신**
   ```
   로그에서 "실시간 시세 수신" 확인
   ```

3. **손절매 설정**
   ```env
   STOP_LOSS_PERCENT=5      # 5% 하락 시 손절
   ```

4. **손절가 계산**
   ```
   매수가: 100,000원
   손절가: 95,000원 (5% 하락)
   현재가가 95,000원 이하로 떨어져야 실행
   ```

#### 해결 방법

**수동 확인**:
```python
# Python으로 직접 확인
매수가 = 100000
손절비율 = 5
손절가 = 매수가 * (1 - 손절비율/100)
print(f"손절가: {손절가}원")
```

**로그 확인**:
```bash
type logs\trading.log | findstr "손절"
```

### 문제: 익절매가 너무 빨리 실행됨

#### 원인: 익절매 비율이 낮음

**현재 설정**:
```env
TAKE_PROFIT_PERCENT=10    # 10% 상승 시 익절
```

**조정**:
```env
TAKE_PROFIT_PERCENT=15    # 15% 상승 시 익절 (더 늦게)
TAKE_PROFIT_PERCENT=8     # 8% 상승 시 익절 (더 빠르게)
```

---

## API 오류

### 문제: "QAxBase::setControl: requested control KHOPENAPI.KHOpenAPICtrl.1 could not be instantiated"

```
QAxBase::setControl: requested control KHOPENAPI.KHOpenAPICtrl.1 could not be instantiated
❌ 예상치 못한 오류 발생: 'QAxWidget' object has no attribute 'OnEventConnect'
```

#### 원인 1: Python 64비트 사용 ⚠️ 가장 흔한 원인

**확인 방법**:
```powershell
python -c "import sys; print('64-bit' if sys.maxsize > 2**32 else '32-bit')"
```

출력이 `64-bit`라면 이것이 문제입니다.

**해결 방법**:

키움 Open API는 **32비트 Python만 지원**합니다.

**Option 1: 자동 설정 (권장)**
```powershell
.\setup_python32.ps1
```

**Option 2: 수동 설정**
1. Python 32비트 다운로드
   - https://www.python.org/downloads/
   - "Windows installer (32-bit)" 선택
   
2. 독립적으로 설치
   - 설치 경로: `C:\Python32\`
   - **UNCHECK** "Add Python to PATH" (중요!)
   
3. 기존 가상환경 삭제 및 재생성
   ```powershell
   Remove-Item -Recurse -Force .venv
   C:\Python32\python.exe -m venv .venv
   .\setup.ps1
   ```

**자세한 가이드**: [SETUP_ISOLATED_PYTHON.md](SETUP_ISOLATED_PYTHON.md)

> **참고**: 이 방법은 시스템의 다른 Python 64비트에 영향을 주지 않습니다.  
> 완전히 독립적인 환경을 구축합니다.

#### 원인 2: 키움 Open API+ 미설치

**확인 방법**:
```
C:\OpenAPI\ 폴더가 존재하는지 확인
```

**해결 방법**:
1. 키움증권 홈페이지에서 Open API+ 다운로드
2. 설치 프로그램 실행
3. PC 재시작
4. 프로그램 재실행

#### 원인 3: Windows 레지스트리 문제

드물지만 OCX 등록이 안 된 경우:

**해결 방법** (관리자 권한 CMD):
```cmd
cd C:\OpenAPI
regsvr32 /u KHOpenAPI.ocx
regsvr32 KHOpenAPI.ocx
```

### 문제: "API 사용량 초과" 오류

```
API 조회 한도 초과
```

#### 원인: 키움 API 제한

**제한사항**:
- 초당 5건
- 일일 1,000건

#### 해결 방법

1. **관심 종목 수 줄이기**
   ```env
   WATCH_LIST=005930,000660    # 2-3개만
   ```

2. **다음 날까지 대기**
   - 일일 한도는 다음 날 00:00에 리셋

3. **프로그램 재시작**
   - 오류 발생 후 재시작 필요

### 문제: "통신 오류" 메시지

```
키움 API 통신 오류
```

#### 원인 및 해결

1. **인터넷 연결**
   - 네트워크 연결 확인
   - 방화벽 설정 확인

2. **키움 서버 점검**
   - 키움증권 홈페이지에서 공지사항 확인
   - 점검 시간: 주로 야간

3. **프로그램 재시작**
   - Ctrl + C로 중지
   - `start.bat` 재실행

### 문제: "주문 실패" 오류

```
주문 전송 실패
```

#### 원인별 해결

1. **잔고 부족**
   - HTS에서 현재 잔고 확인
   - 매수 가능 금액 확인

2. **계좌 비밀번호 오류**
   ```env
   KIWOOM_ACCOUNT_PASSWORD=정확한비밀번호
   ```

3. **주문 가능 시간 아님**
   - 09:00-15:30 사이 확인
   - 점심 시간(12:00-13:00)도 가능

4. **종목 거래 정지**
   - HTS에서 해당 종목 거래 가능 여부 확인

---

## 성능 문제

### 문제: 프로그램이 느려짐

#### 원인 1: 메모리 부족

**확인 방법**:
- 작업 관리자에서 메모리 사용량 확인

**해결 방법**:
1. 다른 프로그램 종료
2. 프로그램 재시작 (일일 1회 권장)
3. RAM 증설 고려

#### 원인 2: 로그 파일 비대화

**확인 방법**:
```bash
dir logs
```

**해결 방법**:
```bash
# 오래된 로그 삭제 (백업 후)
del logs\trading.log.old
del logs\error.log.old
```

또는 주기적으로 로그 파일을 백업하고 삭제:
```bash
# 백업
copy logs\trading.log logs\trading_백업_20251021.log
# 삭제
del logs\trading.log
```

#### 원인 3: 너무 많은 종목

**해결 방법**:
```env
WATCH_LIST=005930,000660,035720    # 3-5개 추천
```

### 문제: CPU 사용률이 높음

#### 정상 범위

- 실행 초기: 30-50%
- 안정화 후: 5-10%
- 매매 시: 일시적으로 증가

#### 비정상 높은 경우

**해결 방법**:
1. 프로그램 재시작
2. Windows 업데이트 확인
3. 백그라운드 프로그램 종료

---

## GUI 응답없음 문제

### 문제: 프로그램 실행 후 일정 시간이 지나면 응답없음 상태가 됨

```
창이 멈춤 / "응답 없음" 표시 / 마우스 클릭 반응 없음
```

#### 원인: 블로킹 루프로 인한 GUI 스레드 차단

**증상**:
- 프로그램 시작 후 몇 분~몇 시간 후 창이 응답하지 않음
- 로그는 정상적으로 출력되지만 GUI가 멈춤
- 작업 관리자에서 "응답 없음" 표시
- 강제 종료만 가능

**해결 방법** (2025-10-26 업데이트):

이 문제는 **완전히 해결**되었습니다! 🎉

**v1.0 (2025-10-26) 이상 버전**:
- ✅ QTimer 기반 논블로킹 방식으로 변경됨
- ✅ GUI가 항상 응답
- ✅ 장시간 안정적 실행 가능
- ✅ Ctrl+C로 정상 종료 가능

**확인 방법**:
```bash
# 로그에서 다음 메시지 확인
✅ QTimer 기반 모니터링 시작 (5초 간격)
📡 PyQt 이벤트 루프 실행 중... (GUI 응답 유지)
```

**이 메시지가 보이면**: 최신 버전으로 업데이트 완료!

**이 메시지가 안 보이면**: 파일을 업데이트하세요:
```bash
# 최신 버전 다운로드
git pull origin main

# 또는 파일 수동 업데이트
# trading_engine.py와 main.py를 최신 버전으로 교체
```

**상세 정보**:
- [GUI_FREEZE_FIX.md](GUI_FREEZE_FIX.md) 참고

**기술적 세부사항**:
- **이전**: `while` 루프 + `time.sleep()` → GUI 블로킹
- **현재**: `QTimer` 콜백 → 논블로킹, 항상 응답

#### 이전 버전 사용자를 위한 임시 해결방법

만약 구 버전을 사용 중이라면:

**방법 1: 최신 버전으로 업데이트 (권장)**
```bash
git pull origin main
```

**방법 2: 프로그램 주기적 재시작**
- 매 1-2시간마다 재시작
- 작업 스케줄러로 자동화 가능

**방법 3: 백그라운드 모드 실행**
- GUI 없이 콘솔 모드로만 실행
- 단, GUI 기능 사용 불가

### 문제: 프로그램이 너무 자주 체크함

```
로그가 너무 많이 출력됨 / CPU 사용률이 높음
```

#### 원인: 체크 간격이 너무 짧음

**해결 방법**:
```python
# config.py에서 조정 (향후 업데이트 예정)
CHECK_INTERVAL = 5000  # 밀리초 (5초 → 10초로 변경 가능)
```

또는 `trading_engine.py` 수정:
```python
self.check_timer.setInterval(10000)  # 5000 → 10000 (10초)
```

---

## 데이터 문제

### 문제: 실시간 데이터가 수신되지 않음

```
[로그에 시세 수신 메시지가 없음]
```

#### 해결 방법

1. **장 시간 확인**
   - 09:00-15:30 사이
   - 토요일/일요일은 거래 없음

2. **로그인 상태 확인**
   - 프로그램 재시작
   - 재로그인

3. **종목 등록 확인**
   ```
   로그에서 "종목 등록" 메시지 확인
   ```

4. **네트워크 확인**
   - 인터넷 연결 상태
   - 방화벽 설정

### 문제: 가격 데이터가 이상함

#### 증상

- 가격이 0원
- 가격이 튀는 현상
- 가격이 업데이트되지 않음

#### 해결 방법

1. **HTS에서 확인**
   - 실제 가격과 비교

2. **종목코드 확인**
   ```env
   WATCH_LIST=005930    # 정확한 6자리 코드
   ```

3. **프로그램 재시작**
   - 데이터 캐시 초기화

---

## 시스템 오류

### 문제: 프로그램이 갑자기 종료됨

#### 확인 방법

```bash
type logs\error.log
```

#### 일반적인 원인

1. **Python 오류**
   - 로그에서 에러 메시지 확인
   - 코드 버그 가능성

2. **메모리 부족**
   - 시스템 메모리 확인
   - 프로그램 재시작

3. **Windows 업데이트**
   - 예고 없는 재부팅
   - 업데이트 설정 조정

4. **전원 문제**
   - 노트북 배터리 확인
   - 전원 관리 설정

#### 예방 방법

1. **자동 재시작 스크립트**
   ```batch
   :start
   start.bat
   timeout /t 10
   goto start
   ```

2. **Windows 설정**
   - 자동 업데이트 시간 조정
   - 절전 모드 비활성화

### 문제: "PyQt5 오류" 메시지

```
ImportError: No module named 'PyQt5'
```

#### 원인: 패키지 미설치

#### 해결 방법

1. **가상환경 활성화**
   ```bash
   .venv\Scripts\activate
   ```

2. **PyQt5 재설치**
   ```bash
   pip install PyQt5
   ```

3. **모든 패키지 재설치**
   ```bash
   pip install -r requirements.txt
   ```

### 문제: "Python을 찾을 수 없습니다"

```
'python'은(는) 내부 또는 외부 명령... 아닙니다.
```

#### 원인: Python이 PATH에 없음

#### 해결 방법

1. **Python 재설치**
   - "Add Python to PATH" 체크 필수

2. **수동으로 PATH 추가**
   - 시스템 속성 → 환경 변수
   - Path에 Python 경로 추가
   - 예: `C:\Python313\`

3. **전체 경로로 실행**
   ```bash
   C:\Python313\python.exe main.py
   ```

---

## 긴급 대응

### 프로그램이 응답하지 않음

1. **Ctrl + C** 시도
2. 안 되면 **작업 관리자** (Ctrl + Shift + Esc)
3. "python.exe" 프로세스 강제 종료
4. 프로그램 재시작

### 예상치 못한 매매 발생

1. **즉시 프로그램 중지** (Ctrl + C)
2. **HTS로 수동 대응**
   - 주문 취소
   - 필요시 수동 매도
3. **로그 확인**
   - 원인 파악
   - 설정 조정

### 계좌 손실 급증

1. **프로그램 즉시 중지**
2. **손절매 실행 확인**
   - 자동 실행되지 않았다면 수동 매도
3. **설정 재검토**
   ```env
   STOP_LOSS_PERCENT=3      # 더 빠른 손절
   POSITION_SIZE_PERCENT=5  # 작은 포지션
   ```

---

## 추가 지원

### 로그 분석 요청

문제 해결이 어려운 경우:

1. **로그 파일 확인**
   ```bash
   type logs\trading.log > 로그분석.txt
   type logs\error.log >> 로그분석.txt
   ```

2. **설정 파일 확인**
   - `.env` 파일 (개인정보 제거 후)

3. **시스템 정보**
   - Windows 버전
   - Python 버전
   - 발생 시각

### 관련 문서

- [FAQ.md](FAQ.md) - 자주 묻는 질문
- [GETTING_STARTED.md](GETTING_STARTED.md) - 완전 설치 가이드
- [STRATEGY_GUIDE.md](STRATEGY_GUIDE.md) - 전략 설명

### 키움증권 지원

- 고객센터: 1544-9944
- Open API 문의: KOA Studio 도움말

---

**문서 버전**: 1.0.0  
**최종 업데이트**: 2025년 10월 21일  
**관련 문서**: [FAQ.md](FAQ.md), [GETTING_STARTED.md](GETTING_STARTED.md)


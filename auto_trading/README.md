# 🤖 CleonAI 자동매매 프로그램

키움증권 Open API를 활용한 PC 기반 Python 자동매매 프로그램

## 📋 목차

- [소개](#소개)
- [주요 기능](#주요-기능)
- [시스템 요구사항](#시스템-요구사항)
- [설치 방법](#설치-방법)
- [설정](#설정)
- [사용 방법](#사용-방법)
- [매매 전략](#매매-전략)
- [리스크 관리](#리스크-관리)
- [문제 해결](#문제-해결)
- [주의사항](#주의사항)

## 소개

이 프로그램은 키움증권 Open API+를 사용하여 주식을 자동으로 매매하는 시스템입니다. 
여러 기술적 분석 전략을 조합하여 매매 신호를 생성하고, 엄격한 리스크 관리를 통해 안전한 거래를 보장합니다.

### 특징

- ✅ **다중 전략 조합**: 이동평균선, RSI, MACD 전략을 종합적으로 활용
- ✅ **자동 리스크 관리**: 손절매, 익절매, 포지션 사이징 자동화
- ✅ **실시간 모니터링**: 실시간 시세 데이터 기반 즉각 반응
- ✅ **모의투자 지원**: 안전한 테스트 환경
- ✅ **상세한 로깅**: 모든 거래 내역과 의사결정 과정 기록

## 주요 기능

### 1. 매매 전략

#### 이동평균선 크로스오버
- 단기 이평선(5일)과 장기 이평선(20일) 교차 감지
- 골든크로스: 매수 신호
- 데드크로스: 매도 신호

#### RSI (Relative Strength Index)
- 과매수/과매도 구간 판단
- RSI < 30: 매수 고려
- RSI > 70: 매도 고려

#### MACD (Moving Average Convergence Divergence)
- MACD선과 시그널선의 교차 포착
- 상향 돌파: 매수 신호
- 하향 돌파: 매도 신호

#### 통합 전략 (합의 알고리즘)
- 3개 전략 중 2개 이상 동일한 신호 → 주문 실행
- 신호 강도 점수화하여 신뢰도 높은 거래만 실행

### 2. 리스크 관리

| 항목 | 기본값 | 설명 |
|------|--------|------|
| 손절매 | -5% | 매수가 대비 5% 하락 시 자동 매도 |
| 익절매 | +10% | 매수가 대비 10% 상승 시 자동 매도 |
| 포지션 사이즈 | 10% | 계좌 잔고의 10%만 투자 |
| 일일 손실 한도 | 3% | 하루 총 손실이 3% 초과 시 거래 중지 |
| 최대 보유 종목 | 3개 | 동시에 보유 가능한 최대 종목 수 |

### 3. 실시간 모니터링

- 실시간 주가 데이터 수신
- 보유 종목 현황 실시간 업데이트
- 손익 실시간 계산
- 거래 내역 자동 로깅

## 시스템 요구사항

### 필수 요구사항

- **운영체제**: Windows 10/11 (64비트)
- **Python**: 3.11 이상
- **메모리**: 4GB RAM 이상
- **저장공간**: 500MB 이상

### 키움증권 관련

- 키움증권 계좌 (실계좌 또는 모의투자)
- 키움 Open API+ 설치
- 공동인증서 (구 공인인증서)

## 설치 방법

### 1. 키움 Open API 설치

자세한 내용은 [KIWOOM_API_SETUP.md](KIWOOM_API_SETUP.md)를 참고하세요.

1. 키움증권 홈페이지에서 Open API+ 신청
2. Open API+ 프로그램 다운로드 및 설치
3. 모의투자 계좌 신청 (선택사항)

### 2. Python 환경 구축

```bash
# Python 3.11 설치 확인
python --version

# 프로젝트 폴더로 이동
cd auto_trading

# 가상환경 생성
python -m venv venv

# 가상환경 활성화 (Windows)
venv\Scripts\activate

# 필요 패키지 설치
pip install -r requirements.txt
```

### 3. 환경 설정

`.env.example` 파일을 `.env`로 복사하고 내용을 수정:

```bash
# .env.example을 .env로 복사
copy .env.example .env

# .env 파일을 편집기로 열어서 수정
notepad .env
```

## 설정

### .env 파일 설정

```env
# 키움증권 계좌 정보
KIWOOM_ACCOUNT_NUMBER=8123456789    # 모의투자 계좌번호
KIWOOM_ACCOUNT_PASSWORD=1234        # 계좌 비밀번호 (4자리)

# 거래 설정
USE_SIMULATION=True                 # True: 모의투자, False: 실계좌
MAX_STOCKS=3                        # 최대 보유 종목 수
POSITION_SIZE_PERCENT=10            # 종목당 투자 비율 (%)
STOP_LOSS_PERCENT=5                 # 손절매 비율 (%)
TAKE_PROFIT_PERCENT=10              # 익절매 비율 (%)
DAILY_LOSS_LIMIT_PERCENT=3          # 일일 손실 한도 (%)

# 관심 종목 설정 (종목코드 6자리, 쉼표로 구분)
WATCH_LIST=005930,000660,035720     # 삼성전자, SK하이닉스, 카카오

# 전략 파라미터는 기본값 사용 또는 원하는 대로 조정
```

### 주요 설정 항목

#### 1. 계좌 정보
- `KIWOOM_ACCOUNT_NUMBER`: 키움증권 계좌번호 (모의투자는 8로 시작)
- `KIWOOM_ACCOUNT_PASSWORD`: 계좌 비밀번호 4자리

#### 2. 관심 종목
- `WATCH_LIST`: 자동매매할 종목 코드 리스트 (쉼표로 구분)
- 종목 코드는 네이버 증권에서 확인 가능

#### 3. 리스크 설정
- 모든 비율은 % 단위로 입력
- 보수적으로 설정할수록 안전함

## 사용 방법

### 1. 기본 실행

```bash
# 가상환경 활성화 (매번 실행 전)
venv\Scripts\activate

# 프로그램 실행
python main.py
```

### 2. 실행 과정

1. **설정 확인**: .env 파일 유효성 검사
2. **로그인**: 키움증권 공동인증서 로그인
3. **초기화**: 계좌 정보 및 보유 종목 조회
4. **자동매매 시작**: Enter 키를 눌러 시작
5. **실시간 모니터링**: Ctrl+C로 언제든지 중지 가능

### 3. 로그 확인

```bash
# 실시간 로그 확인
type logs\trading.log

# 에러 로그만 확인
type logs\error.log
```

### 4. 프로그램 중지

- **Ctrl + C**: 안전하게 중지
- 보유 종목은 유지되며, 다음 실행 시 계속 관리됨
- 모든 거래 내역은 로그 파일에 저장됨

## 매매 전략

자세한 전략 설명은 [STRATEGY_GUIDE.md](STRATEGY_GUIDE.md)를 참고하세요.

### 신호 생성 과정

1. **데이터 수집**: 실시간 주가 데이터 수신 및 저장
2. **지표 계산**: SMA, RSI, MACD 등 기술적 지표 계산
3. **전략 실행**: 각 전략이 독립적으로 신호 생성
4. **합의 도출**: 다수결로 최종 신호 결정
5. **리스크 검증**: 리스크 관리 규칙 확인
6. **주문 실행**: 모든 조건 충족 시 주문 전송

### 매수 조건

다음 조건을 **모두** 충족해야 매수:

- ✅ 3개 전략 중 2개 이상이 매수 신호
- ✅ 최대 보유 종목 수 미만
- ✅ 일일 손실 한도 미초과
- ✅ 충분한 잔고 보유
- ✅ 동일 종목 미보유

### 매도 조건

다음 조건 중 **하나라도** 충족 시 매도:

- 📊 3개 전략 중 2개 이상이 매도 신호
- 🔴 손절매 조건 발생 (-5%)
- 🟢 익절매 조건 발생 (+10%)

## 리스크 관리

### 1. 포지션 관리

```
예시: 계좌 잔고 10,000,000원
- 종목당 투자금: 1,000,000원 (10%)
- 매수가 75,000원 → 13주 매수
- 손절가: 71,250원 (-5%)
- 익절가: 82,500원 (+10%)
```

### 2. 일일 손실 한도

```
시작 잔고: 10,000,000원
손실 한도: 300,000원 (3%)

현재 잔고가 9,700,000원 이하로 떨어지면
→ 자동으로 모든 거래 중지
```

### 3. 강제 청산

다음 상황에서 자동으로 포지션 청산:

- 손절매 가격 도달
- 익절매 가격 도달
- 일일 손실 한도 초과
- 장 마감 시간 (15:30)

## 문제 해결

### Q1. "로그인 실패" 오류

**원인**:
- 키움 Open API+가 설치되지 않음
- 공동인증서 문제
- 모의투자/실계좌 설정 불일치

**해결**:
```bash
1. KOA Studio가 정상 실행되는지 확인
2. 공동인증서로 KOA Studio 로그인 테스트
3. .env 파일의 USE_SIMULATION 설정 확인
4. 계좌번호가 정확한지 확인 (모의투자는 8로 시작)
```

### Q2. "설정 오류" 메시지

**원인**:
- .env 파일이 없거나 잘못됨

**해결**:
```bash
1. .env.example 파일을 .env로 복사
2. 필수 항목 입력 확인:
   - KIWOOM_ACCOUNT_NUMBER
   - KIWOOM_ACCOUNT_PASSWORD
   - WATCH_LIST
```

### Q3. 매매가 실행되지 않음

**원인**:
- 데이터 부족 (최소 30개 필요)
- 신호 강도 부족
- 리스크 제한

**해결**:
```bash
1. 프로그램을 더 오래 실행 (데이터 축적)
2. 로그에서 "신호: 관망" 확인
3. MIN_SIGNAL_STRENGTH 조정 (2 → 1)
4. 리스크 한도 확인
```

### Q4. "API 사용량 초과" 오류

**원인**:
- 일일 조회 한도 초과 (1,000건/일)

**해결**:
```bash
1. 다음 날까지 대기
2. 관심 종목 수 줄이기
3. 조회 빈도 감소
```

## 주의사항

### ⚠️ 중요 경고

1. **투자 리스크**
   - 자동매매도 손실 위험이 있습니다
   - 반드시 모의투자로 충분히 테스트하세요
   - 실계좌 사용 시 소액부터 시작하세요

2. **기술적 리스크**
   - 시스템 오류, 네트워크 장애 가능
   - 키움 API 서버 점검 시 사용 불가
   - 정전 등 예상치 못한 상황 대비

3. **법적 리스크**
   - 프로그램매매 신고 의무 확인
   - 관련 법규 준수 필요
   - 불공정거래 금지

### 💡 권장사항

1. **모의투자 기간**
   - 최소 1개월 이상 모의투자로 테스트
   - 다양한 시장 상황에서 검증
   - 전략과 리스크 설정 최적화

2. **실계좌 전환**
   - 모의투자 성과 확인 후
   - 소액(100만원 이하)으로 시작
   - 점진적으로 금액 증가

3. **모니터링**
   - 정기적으로 성과 확인
   - 로그 파일 검토
   - 비정상 동작 즉시 중지

### 🔒 보안

1. **.env 파일 보안**
   - 절대로 Git에 커밋하지 마세요
   - 계좌 정보는 안전하게 보관
   - 타인과 공유 금지

2. **실행 환경**
   - 신뢰할 수 있는 PC에서만 실행
   - 백신 프로그램 최신 유지
   - 의심스러운 프로그램과 함께 실행 금지

## 라이선스

이 프로그램은 교육 및 개인 학습 목적으로 제공됩니다.

**면책 조항**: 
- 이 프로그램 사용으로 인한 모든 손실은 사용자 본인의 책임입니다.
- 개발자는 어떠한 투자 손실에 대해서도 책임지지 않습니다.
- 실제 투자는 신중하게 결정하시기 바랍니다.

## 문의

문제가 발생하거나 질문이 있으시면:

1. 로그 파일 확인 (`logs/trading.log`, `logs/error.log`)
2. [KIWOOM_API_SETUP.md](KIWOOM_API_SETUP.md) 참고
3. [STRATEGY_GUIDE.md](STRATEGY_GUIDE.md) 참고

---

**버전**: 1.0.0  
**최종 업데이트**: 2025년 10월 16일  
**제작**: CleonAI 개발팀

